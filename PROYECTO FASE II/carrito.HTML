<!DOCTYPE html>
<?xml version="1.0" encoding="iso-8859-1"?>

<html>
    
    <head>
        <title>Bynary Shop</title>
        <link rel="shortcut icon" href="favicon.ico">
        <style>
        
        .box01{

            border: 5px solid red;
            background: white;
            color: black;
            display: flex;
            align-items: flex-end;
          }
          
        .box02{
            width: 500px;
            height: 350px;
          }
          
        .box03{
            width: 100%;
            height: 350px;
          }
             
        .box04{

            border: 5px solid red;
            background: white;
            color: black;
            display: flex;
            align-items: flex-end;
        }

        
        .box05{
            width: 30px;
            height: 40px;
          }
          
        .box06{
            width: 100%;
            height: 40px;
          }
                  

        </style>
    </head>

    <body id=body>
        <h2>CARRITO</h2>
           
            <div id="galeria"></div>
            <div id="precioTotal"></div>

         <script>

            
            var indice=-1;
            var carrito = {};
            var carritoString = "";
            var imagenesJSON;


            var reader = new XMLHttpRequest() || new ActiveXObject('MSXML2.XMLHTTP');

            function loadFile() {
                reader.open('get', 'archivotxt.ini', true); 
                reader.onreadystatechange = displayContents;
                //reader.send(null);
            }

            function displayContents() {
                if(reader.readyState==4) {
                    console.log(reader.responseText);
                    //var el = document.getElementById('contenido-archivo');
                    //el.innerHTML = reader.responseText;
                }
            }


            function leerArchivos(){

                loadFile();
                displayContents();
            }

    
            
           




            window.onload = function() {
               //carritoString=sessionStorage.getItem("carritoString");
                //renderizarGaleria(imagenes);

                            console.log(carritoString);
                        
            var imagenes_old = [
                {
                    src: 'imagenes/bs.png',
                    alt: 'Gatitos, no se puede decir más',
                    nombre: 'Artíulo 1',
                    precio: 52,
                    descripcion: 'descripcion1',
                    cantidad: '10',
                    numero: '1'
                },
                {
                    src: 'imagenes/bs.png',
                    alt: 'Gatitos, no se puede decir más',
                    nombre: 'Articulo 2',
                    precio: 82,
                    descripcion: 'descripcion2',
                    cantidad: '50',
                    numero: '2'
                },
                {
                    src: 'imagenes/bs.png',
                    alt: 'Gatitos, no se puede decir más',
                    nombre: 'Articulo 3',
                    precio: 99,
                    descripcion: 'descripcion3',
                    cantidad: '100',
                    numero: '3'
                },


            ];

        var imagenes = '['

                var parametro = new URLSearchParams(location.search);
                carritoString = parametro.get('carritoString');
            
                //window.history.replaceState({}, '', '/carrito.html');


                console.log(carritoString);

                var linea = "";
                indice = -1;
                for(var i = 0; i < carritoString.length; i = i+1){
                    if(carritoString[i]=="*"){
                        indice =indice + 1; 
                        carrito[indice]= linea;
                        i=i+4;
                        linea = "";
                    }else{
                        linea = linea + carritoString[i];
                    }

                }
                    var indiceJSON= -1;
                for (var row in carrito) {
                        indiceJSON =indiceJSON + 1;
                            var campo1 = parseInt(carrito[row].substring(0,carrito[row].indexOf("-")))-1;
                            var campo2 = parseInt(carrito[row].substring(carrito[row].indexOf("-")+1));
                            console.log(campo1);
                            console.log(campo2);
                            console.log(imagenes_old[campo1].descripcion);

                            imagenes = imagenes + "{\"src\": \"" + imagenes_old[campo1].src + "\",";
                            imagenes = imagenes + "\"alt\": \"" + imagenes_old[campo1].alt + "\",";
                            imagenes = imagenes + "\"nombre\": \"" + imagenes_old[campo1].nombre + "\",";
                            imagenes = imagenes + "\"precio\": " + imagenes_old[campo1].precio + ",";
                            imagenes = imagenes + "\"descripcion\": \"" + imagenes_old[campo1].descripcion + "\",";
                            imagenes = imagenes + "\"cantidad\": \"" + imagenes_old[campo1].cantidad + "\",";
                            imagenes = imagenes + "\"numero\": \"" + indiceJSON + "\",";
                            imagenes = imagenes + "\"cantidad_carrito\": " + campo2 + "},";



                    //  src: 'imagenes/bs.png',
                  //  alt: 'Gatitos, no se puede decir más',
                 //   nombre: 'Artíulo 1',
                //    precio: 52,
                 //   descripcion: 'descripcion1',
                 //   cantidad: '10',
                 //   numero: '1'
                            


                }  
                
               imagenes = imagenes.substring(0,imagenes.length-1) + "]";
                console.log(imagenes)

                imagenesJSON = JSON.parse(imagenes);
                renderizarGaleria(imagenesJSON);
            };


            function CantidadSuma(cantidadNumero, numeroProducto){
                var cant = document.getElementById(cantidadNumero).value;
                var cant2 = parseInt(cant) + 1;
                var resta =parseInt(numeroProducto)
                var cantInventario =parseInt(imagenesJSON[resta].cantidad);
                if(cant2 <= cantInventario){
                document.getElementById(cantidadNumero).value = cant2;

                
                imagenesJSON[resta].cantidad_carrito= cant2;
                renderizarGaleria(imagenesJSON)
                }
            }

            function CantidadResta(cantidadNumero, numeroProducto){
                var cant = document.getElementById(cantidadNumero).value;
                var cant2 = parseInt(cant) -1; 
               
                if(cant2 >0) {
                    document.getElementById(cantidadNumero).value = cant2;
                

                var resta =parseInt(numeroProducto)
                imagenesJSON[resta].cantidad_carrito= cant2;
                renderizarGaleria(imagenesJSON)
                }
            }

            function EliminarCarrito(cantidadNumero, numeroProducto){
                var resta =parseInt(numeroProducto)
                delete imagenesJSON[resta];

                renderizarGaleria(imagenesJSON)
            }

        function renderizarGaleria(imagenes) {
            let html = '';
            var precioTotal= 0;
            imagenes.forEach(function(imagen){
                //var mumeroCantidad = "Cantidad"+ ${imagen.numero};
                var precioParcial= parseInt(imagen.precio)*parseInt(imagen.cantidad_carrito);
                precioTotal = precioTotal + precioParcial;
                html += `
                <div class="box01">
                    <div class="box02">
                        <img src="${imagen.src}" alt="${imagen.alt}" width="200px" />
                        <h3>${imagen.nombre}</h3>
                        <p>Precio: ${imagen.precio} Bs.</p>
                        <p>Cantidad: ${imagen.cantidad}</p>
                    </div>

                    <div class="box03">
                        <p>Descripcion: ${imagen.descripcion}</p>
                        <br> <input class="inputs"  name="cant" value = ${imagen.cantidad_carrito} id= "cantidad${imagen.numero}">
                        <br><input  class="boton" type="button" value="+" name="boton1" onclick = CantidadSuma("cantidad${imagen.numero}","${imagen.numero}") >
                        <br><input  class="boton" type="button" value="-" name="boton2" onclick = CantidadResta("cantidad${imagen.numero}","${imagen.numero}")>
                        <br><input  class="boton" type="button" value="Eliminar del carrito" name="eliminarCarrito" onclick = EliminarCarrito("cantidad${imagen.numero}","${imagen.numero}")>
                        <br><p>Precio: ${precioParcial}</p>
                    </div>
                    
                </div>
                `;
            });
            
            document.getElementById("galeria").innerHTML = html;
            document.getElementById("precioTotal").innerHTML = "Precio a pagar: " + precioTotal;
        }


            
     </script>    

    </body>

</html>
