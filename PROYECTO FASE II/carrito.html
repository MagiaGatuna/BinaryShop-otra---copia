<!DOCTYPE html>
<?xml version="1.0" encoding="iso-8859-1"?>

<html>
    
    <head>
        <title>Binary Shop</title>
        <link rel="shortcut icon" href="favicon.ico">
        <link rel="stylesheet" href="carrito.css">
        <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
      
    </head>

    <body id=body>

        <header>
        
        </i><label for="menu"><i class='bx bx-menu'></i>
        </label>
        <ul class="icons">
        <li><input  class="boton" type="image" src="imagenes/whitecart.png" value="Ir a carrito" name="IrACarrito" id="whitecart" onclick = irACarrito() ></li>
        <li><i class='bx bx-search'></i></li>
        <li><i class='bx bxs-bell-ring'></i></li>
        <li><i class='bx bx-user-circle'></i></li>
        <li><a href="#" class="enlace"><img src="imagenes/bysh.png" alt="" class="logo"></a></li>
        </ul>
    
        
    
        <div>
            <input type="checkbox" id="menu">
            
    
        <nav class="nav">
            
            </i><label for="menu"><i class='bx bx-x'></i></label>
            
            <ul class="list">
                <li><a href="interfazComp.html">Inicio</a></li>
                <li><a href="#">Carrito</a></li>
                <li><a href="PantallaP.html">Cerrar sesión</a></li>
            </ul>
            
        </nav>
        
        </div>
    
        </header>

        <h2>CARRITO</h2>
           
            <div id="galeria"></div>
            <div id="precioTotal"></div>

         <script>

            
            var indice=-1;
            var carrito = {};
            var carritoString = "";
            var imagenesJSON;


            var reader = new XMLHttpRequest() || new ActiveXObject('MSXML2.XMLHTTP');

            function loadFile() {
                reader.open('get', 'archivotxt.ini', true); 
                reader.onreadystatechange = displayContents;
                //reader.send(null);
            }

            function displayContents() {
                if(reader.readyState==4) {
                    console.log(reader.responseText);
                    //var el = document.getElementById('contenido-archivo');
                    //el.innerHTML = reader.responseText;
                }
            }


            function leerArchivos(){

                loadFile();
                displayContents();
            }

    

            window.onload = function() {
               //carritoString=sessionStorage.getItem("carritoString");
                //renderizarGaleria(imagenes);

                            console.log(carritoString);
                        
            var imagenes_old = [
            {
                src: 'imagenes/Eco-CepilloDental.jpg',
                alt: 'la imagen no fue encontrada',
                nombre: 'Eco-Cepillo Dental',
                precio: 5.99,
                descripcion: 'Cepillo de bambú biodegradable con cerdas de carbón activado.',
                cantidad: '100',
                numero: '1'
            },
            {
                src: 'imagenes/BotelladeAguaAutoLimpiable.png',
                alt: 'la imagen no fue encontrada',
                nombre: 'Botella de Agua Auto-Limpiable',
                precio: 29.99,
                descripcion: 'Botella con luz UV integrada para purificar el agua.',
                cantidad: '50',
                numero: '2'
            },
            {
                src: 'imagenes/PlumadeBorradoInstantáneo.jpg',
                alt: 'la imagen no fue encontrada',
                nombre: 'Pluma de Borrado Instantáneo',
                precio: 9.99,
                descripcion: 'Pluma que borra tinta con un solo clic, sin dejar rastro.',
                cantidad: '200',
                numero: '3'
            },
			{
                src: 'imagenes/MochilaSolarCargadora.png',
                alt: 'la imagen no fue encontrada',
                nombre: 'Mochila Solar Cargadora',
                precio: 79.99,
                descripcion: 'Mochila con panel solar integrado para cargar dispositivos móviles.',
                cantidad: '25',
                numero: '4'
            },
			{
                src: 'imagenes/AudífonosdeTraducciónSimultánea.jpg',
                alt: 'la imagen no fue encontrada',
                nombre: 'Audífonos de Traducción Simultánea',
                precio: 149.99,
                descripcion: 'Audífonos que traducen idiomas en tiempo real.',
                cantidad: '10',
                numero: '5'
            },
			{
                src: 'imagenes/AlmohadadeMasajeInteligente.png',
                alt: 'la imagen no fue encontrada',
                nombre: 'Almohada de Masaje Inteligente',
                precio: 69.99,
                descripcion: 'Almohada que se adapta a tu cuerpo y proporciona masajes personalizados.',
                cantidad: '30',
                numero: '6'
            },
			{
                src: 'imagenes/LámparadeEscritorioconCargaInalámbrica.jpg',
                alt: 'la imagen no fue encontrada',
                nombre: 'Lámpara de Escritorio con Carga Inalámbrica',
                precio: 49.99,
                descripcion: 'Lámpara que carga tu teléfono mientras ilumina tu espacio.',
                cantidad: '100',
                numero: '7'
            },
			{
                src: 'imagenes/GuantesdeRealidadVirtualTáctiles.jpg',
                alt: 'la imagen no fue encontrada',
                nombre: 'Guantes de Realidad Virtual Táctiles',
                precio: 199.99,
                descripcion: 'Guantes que te permiten sentir objetos en la realidad virtual.',
                cantidad: '5',
                numero: '8'
            },
			{
                src: 'imagenes/CámaradeSeguridadconReconocimientoFacial.png',
                alt: 'la imagen no fue encontrada',
                nombre: 'Cámara de Seguridad con Reconocimiento Facial',
                precio: 89.99,
                descripcion: 'Cámara que identifica a las personas y envía alertas.',
                cantidad: '15',
                numero: '9'
            },
			{
                src: 'imagenes/RobotAspiradorconMapeoInteligente.jpg',
                alt: 'la imagen no fue encontrada',
                nombre: 'Robot Aspirador con Mapeo Inteligente',
                precio: 249.99,
                descripcion: 'Aspirador que limpia tu casa de forma autónoma, creando mapas.',
                cantidad: '8',
                numero: '10'
            },
			{
                src: 'imagenes/BicicletaEléctricaPlegable.jpg',
                alt: 'la imagen no fue encontrada',
                nombre: 'Bicicleta Eléctrica Plegable',
                precio: 599.99,
                descripcion: 'Bicicleta que se pliega para facilitar su transporte.',
                cantidad: '40',
                numero: '11'
            },

			{
                src: 'imagenes/RelojInteligenteconMonitordeSueño.jpg',
                alt: 'la imagen no fue encontrada',
                nombre: 'Reloj Inteligente con Monitor de Sueño',
                precio: 129.99,
                descripcion: 'Reloj que analiza tu sueño y te ayuda a mejorarlo.',
                cantidad: '20',
                numero: '12'
            },
			{
                src: 'imagenes/Impresora3DdeBolsillo.png',
                alt: 'la imagen no fue encontrada',
                nombre: 'Impresora 3D de Bolsillo',
                precio: 349.99,
                descripcion: 'Impresora que cabe en tu bolsillo y te permite imprimir objetos pequeños.',
                cantidad: '2',
                numero: '13'
            },
			{
                src: 'imagenes/KitdeCultivoHidropónicoCasero.jpg',
                alt: 'la imagen no fue encontrada',
                nombre: 'Kit de Cultivo Hidropónico Casero',
                precio: 59.99,
                descripcion: 'Kit para cultivar tus propias hierbas y verduras en casa.',
                cantidad: '25',
                numero: '14'
            },
			{
                src: 'imagenes/DroneconCámara4KyEstabilización.jpg',
                alt: 'la imagen no fue encontrada',
                nombre: 'Drone con Cámara 4K y Estabilización',
                precio: 499.99,
                descripcion: 'Drone que graba videos y toma fotos de alta calidad.',
                cantidad: '6',
                numero: '15'
            },
			{
                src: 'imagenes/ProyectorHolográficoPortátil.png',
                alt: 'la imagen no fue encontrada',
                nombre: 'Proyector Holográfico Portátil',
                precio: 299.99,
                descripcion: 'Proyector que crea hologramas en cualquier superficie.',
                cantidad: '12',
                numero: '16'
            },
			{
                src: 'imagenes/MesadeEscritorioAjustableconMemoria.jpg',
                alt: 'la imagen no fue encontrada',
                nombre: 'Mesa de Escritorio Ajustable con Memoria',
                precio: 399.99,
                descripcion: 'Mesa que se ajusta a tu altura y guarda tus posiciones favoritas.',
                cantidad: '4',
                numero: '17'
            },
			{
                src: 'imagenes/SillaErgonómicaconCalefacción.jpg',
                alt: 'la imagen no fue encontrada',
                nombre: 'Silla Ergonómica con Calefacción',
                precio: 279.99,
                descripcion: 'Silla que se adapta a tu cuerpo y te mantiene caliente.',
                cantidad: '9',
                numero: '18'
            },
			{
                src: 'imagenes/PurificadordeAireconAromaterapia.jpg',
                alt: 'la imagen no fue encontrada',
                nombre: 'Purificador de Aire con Aromaterapia',
                precio: 119.99,
                descripcion: 'Purificador que elimina las impurezas del aire y libera aromas.',
                cantidad: '18',
                numero: '19'
            },
			{
                src: 'imagenes/AltavozInteligenteconPantallaTáctil.jpg',
                alt: 'la imagen no fue encontrada',
                nombre: 'Altavoz Inteligente con Pantalla Táctil',
                precio: 169.99,
                descripcion: 'Altavoz que te permite controlar tu hogar y ver videos.',
                cantidad: '11',
                numero: '20'
            },
			{
                src: 'imagenes/GafasdeRealidadAumentadaconGPS.jpg',
                alt: 'la imagen no fue encontrada',
                nombre: 'Gafas de Realidad Aumentada con GPS',
                precio: 229.99,
                descripcion: 'Gafas que te muestran información sobre el mundo real.',
                cantidad: '7',
                numero: '21'
            },
			{
                src: 'imagenes/MaletaInteligenteconSeguimientoGPS.png',
                alt: 'la imagen no fue encontrada',
                nombre: 'Maleta Inteligente con Seguimiento GPS',
                precio: 189.99,
                descripcion: 'Maleta que te permite saber dónde está en todo momento.',
                cantidad: '13',
                numero: '22'
            },
			{
                src: 'imagenes/CargadorSolarPortátilparaLaptop.jpg',
                alt: 'la imagen no fue encontrada',
                nombre: 'Cargador Solar Portátil para Laptop',
                precio: 139.99,
                descripcion: 'Cargador que te permite cargar tu laptop en cualquier lugar.',
                cantidad: '17',
                numero: '23'
            },
			{
                src: 'imagenes/TecladoVirtualProyectado.jpg',
                alt: 'la imagen no fue encontrada',
                nombre: 'Teclado Virtual Proyectado',
                precio: 99.99,
                descripcion: 'Teclado que se proyecta en cualquier superficie.',
                cantidad: '22',
                numero: '24'
            },
			{
                src: 'imagenes/Ratónqueescaneadocumentosylosconvierteentexto.jpg',
                alt: 'la imagen no fue encontrada',
                nombre: 'Ratón Ergonómico con Escáner',
                precio: 79.99,
                descripcion: 'Ratón que escanea documentos y los convierte en texto.',
                cantidad: '28',
                numero: '25'
            },
			{
                src: 'imagenes/LibretaInteligenteconDigitalización.jpg',
                alt: 'la imagen no fue encontrada',
                nombre: 'Libreta Inteligente con Digitalización',
                precio: 69.99,
                descripcion: 'Libreta que digitaliza tus notas y dibujos.',
                cantidad: '32',
                numero: '26'
            },
			{
                src: 'imagenes/TraductordeIdiomasdeBolsillo.jpg',
                alt: 'la imagen no fue encontrada',
                nombre: 'Traductor de Idiomas de Bolsillo',
                precio: 149.99,
                descripcion: 'Dispositivo que traduce idiomas en tiempo real.',
                cantidad: '10',
                numero: '27'
            },
			{
                src: 'imagenes/MedidordeCalidaddelAirePortátil.jpg',
                alt: 'la imagen no fue encontrada',
                nombre: 'Medidor de Calidad del Aire Portátil',
                precio: 89.99,
                descripcion: 'Dispositivo que mide la calidad del aire y te alerta.',
                cantidad: '15',
                numero: '28'
            },
			{
                src: 'imagenes/BásculaInteligentecon AnálisisCorporal.jpg',
                alt: 'la imagen no fue encontrada',
                nombre: 'Báscula Inteligente con Análisis Corporal',
                precio: 129.99,
                descripcion: 'Báscula que analiza tu composición corporal y te da consejos.',
                cantidad: '20',
                numero: '29'
            },
			{
                src: 'imagenes/DispensadordeComidaInteligenteparaMascotas.jpg',
                alt: 'la imagen no fue encontrada',
                nombre: 'Dispensador de Comida Inteligente para Mascotas',
                precio: 169.99,
                descripcion: 'Dispositivo que alimenta a tu mascota automáticamente.',
                cantidad: '40',
                numero: '30'
            },
			{
                src: 'imagenes/Termómetro Inteligente sin Contacto.jpg',
                alt: 'la imagen no fue encontrada',
                nombre: 'Termómetro Inteligente sin Contacto',
                precio: 59.99,
                descripcion: 'Termómetro que mide la temperatura sin tocar la piel.',
                cantidad: '25',
                numero: '31'
            },
			{
                src: 'imagenes/KitdePrimerosAuxiliosInteligente.jpg',
                alt: 'la imagen no fue encontrada',
                nombre: 'Kit de Primeros Auxilios Inteligente',
                precio: 79.99,
                descripcion: 'Kit que te guía en caso de emergencia.',
                cantidad: '28',
                numero: '32'
            },
			{
                src: 'imagenes/CandadoInteligenteconHuellaDactilar.jpg',
                alt: 'la imagen no fue encontrada',
                nombre: 'Candado Inteligente con Huella Dactilar',
                precio: 49.99,
                descripcion: 'Candado que se abre con tu huella dactilar.',
                cantidad: '30',
                numero: '33'
            },
            ];

        var imagenes = '['

                var parametro = new URLSearchParams(location.search);
                carritoString = parametro.get('carritoString');
            
                //window.history.replaceState({}, '', '/carrito.html');


                console.log(carritoString);

                var linea = "";
                indice = -1;
                for(var i = 0; i < carritoString.length; i = i+1){
                    if(carritoString[i]=="*"){
                        indice =indice + 1; 
                        carrito[indice]= linea;
                        i=i+4;
                        linea = "";
                    }else{
                        linea = linea + carritoString[i];
                    }

                }
                    var indiceJSON= -1;
                for (var row in carrito) {
                        indiceJSON =indiceJSON + 1;
                            var campo1 = parseInt(carrito[row].substring(0,carrito[row].indexOf("-")))-1;
                            var campo2 = parseInt(carrito[row].substring(carrito[row].indexOf("-")+1));
                            console.log(campo1);
                            console.log(campo2);
                            console.log(imagenes_old[campo1].descripcion);

                            imagenes = imagenes + "{\"src\": \"" + imagenes_old[campo1].src + "\",";
                            imagenes = imagenes + "\"alt\": \"" + imagenes_old[campo1].alt + "\",";
                            imagenes = imagenes + "\"nombre\": \"" + imagenes_old[campo1].nombre + "\",";
                            imagenes = imagenes + "\"precio\": " + imagenes_old[campo1].precio + ",";
                            imagenes = imagenes + "\"descripcion\": \"" + imagenes_old[campo1].descripcion + "\",";
                            imagenes = imagenes + "\"cantidad\": \"" + imagenes_old[campo1].cantidad + "\",";
                            imagenes = imagenes + "\"numero\": \"" + indiceJSON + "\",";
                            imagenes = imagenes + "\"cantidad_carrito\": " + campo2 + "},";



                    //  src: 'imagenes/bs.png',
                  //  alt: 'Gatitos, no se puede decir más',
                 //   nombre: 'Artíulo 1',
                //    precio: 52,
                 //   descripcion: 'descripcion1',
                 //   cantidad: '10',
                 //   numero: '1'
                            


                }  
                
               imagenes = imagenes.substring(0,imagenes.length-1) + "]";
                console.log(imagenes)

                imagenesJSON = JSON.parse(imagenes);
                renderizarGaleria(imagenesJSON);
            };


            function CantidadSuma(cantidadNumero, numeroProducto){
                var cant = document.getElementById(cantidadNumero).value;
                var cant2 = parseInt(cant) + 1;
                var resta =parseInt(numeroProducto)
                var cantInventario =parseInt(imagenesJSON[resta].cantidad);
                if(cant2 <= cantInventario){
                document.getElementById(cantidadNumero).value = cant2;

                
                imagenesJSON[resta].cantidad_carrito= cant2;
                renderizarGaleria(imagenesJSON)
                }
            }

            function CantidadResta(cantidadNumero, numeroProducto){
                var cant = document.getElementById(cantidadNumero).value;
                var cant2 = parseInt(cant) -1; 
               
                if(cant2 >0) {
                    document.getElementById(cantidadNumero).value = cant2;
                

                var resta =parseInt(numeroProducto)
                imagenesJSON[resta].cantidad_carrito= cant2;
                renderizarGaleria(imagenesJSON)
                }
            }

            function EliminarCarrito(cantidadNumero, numeroProducto){
                var resta =parseInt(numeroProducto)
                delete imagenesJSON[resta];

                renderizarGaleria(imagenesJSON)
            }

        function renderizarGaleria(imagenes) {
            let html = '';
            var precioTotal= 0;
            imagenes.forEach(function(imagen){
                //var mumeroCantidad = "Cantidad"+ ${imagen.numero};
                var precioParcial= parseInt(imagen.precio)*parseInt(imagen.cantidad_carrito);
                precioTotal = precioTotal + precioParcial;
                html += `
                <div class="box01">
                    <div class="box02">
                        <img src="${imagen.src}" alt="${imagen.alt}" width="200px" />
                        <h3>${imagen.nombre}</h3>
                        <p>Precio: ${imagen.precio} Bs.</p>
                        <p>Cantidad: ${imagen.cantidad}</p>
                    </div>

                    <div class="box03">
                        <p>Descripcion: ${imagen.descripcion}</p>
                        <br> <input class="inputs"  name="cant" value = ${imagen.cantidad_carrito} id= "cantidad${imagen.numero}">
                        <br><input  class="boton" type="button" value="+" name="boton1" id="boton2" onclick = CantidadSuma("cantidad${imagen.numero}","${imagen.numero}") >
                        <br><input  class="boton" type="button" value="-" name="boton2" id="boton1" onclick = CantidadResta("cantidad${imagen.numero}","${imagen.numero}")>
                        <br><input  class="boton" type="button" value="Eliminar del carrito" name="eliminarCarrito" id="eliminarCarrito" onclick = EliminarCarrito("cantidad${imagen.numero}","${imagen.numero}")>
                        <br><p>Precio: ${precioParcial}</p>
                    </div>
                    
                </div>
                `;
            });
            
            document.getElementById("galeria").innerHTML = html;
            document.getElementById("precioTotal").innerHTML = "Precio a pagar: " + precioTotal;
        }

     </script>    

    </body>

</html>